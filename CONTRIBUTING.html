<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Contributing to meteospain • meteospain</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Contributing to meteospain"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">meteospain</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Services</h6></li>
    <li><a class="dropdown-item" href="articles/aemet.html">AEMET service</a></li>
    <li><a class="dropdown-item" href="articles/meteocat.html">MeteoCat service</a></li>
    <li><a class="dropdown-item" href="articles/meteogalicia.html">MeteoGalicia service</a></li>
    <li><a class="dropdown-item" href="articles/ria.html">RIA service</a></li>
    <li><a class="dropdown-item" href="articles/meteoclimatic.html">Meteoclimatic service</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Workflows</h6></li>
    <li><a class="dropdown-item" href="articles/api_limits.html">API limits and loops</a></li>
    <li><a class="dropdown-item" href="articles/compatibility.html">Compatibility between services</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emf-creaf/meteospain/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Contributing to meteospain</h1>
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/meteospain/blob/main/.github/CONTRIBUTING.md" class="external-link"><code>.github/CONTRIBUTING.md</code></a></small>
    </div>

<div id="contributing-to-meteospain" class="section level1">

<p>This outlines how to propose a change to meteospain.</p>
<div class="section level2">
<h2 id="bigger-changes">Bigger changes<a class="anchor" aria-label="anchor" href="#bigger-changes"></a></h2>
<p>If you want to make a bigger change, it’s a good idea to first file an issue and make sure someone from the team agrees that it’s needed. If you’ve found a bug, please file an issue that illustrates the bug with a minimal <a href="https://www.tidyverse.org/help/#reprex" class="external-link">reprex</a> (this will also help you write a unit test, if needed).</p>
<div class="section level3">
<h3 id="pull-request-process">Pull request process<a class="anchor" aria-label="anchor" href="#pull-request-process"></a></h3>
<ul><li><p>Fork the package and clone onto your computer. If you haven’t done this before, we recommend using <code>usethis::create_from_github("emf-creaf/meteospain", fork = TRUE)</code>.</p></li>
<li><p>Install all development dependences with <code>devtools::install_dev_deps()</code>, and then make sure the package passes R CMD check by running <code>devtools::check()</code>. If R CMD check doesn’t pass cleanly, it’s a good idea to ask for help before continuing.</p></li>
<li><p>For passing tests and building vignettes, you will need API keys for AEMET and MeteoCat (see <code><a href="reference/services_options.html">?services_options</a></code>). A workaround to develop without those keys is setting the <code>NOT_CRAN</code> environment variable to <code>false</code> (<code>Sys.setenv(NOT_CRAN = 'false')</code>), but with this, most of the tests and examples will be not run when building, testing and checking.</p></li>
<li><p>Create a Git branch for your pull request (PR). We recommend using <code>usethis::pr_init("brief-description-of-change")</code>.</p></li>
<li><p>Make your changes, commit to git, and then create a PR by running <code>usethis::pr_push()</code>, and following the prompts in your browser. The title of your PR should briefly describe the change. The body of your PR should contain <code>Fixes #issue-number</code>.</p></li>
<li><p>For user-facing changes, add a bullet to the top of <code>NEWS.md</code> (i.e. just below the first header). Follow the style described in <a href="https://style.tidyverse.org/news.html" class="external-link uri">https://style.tidyverse.org/news.html</a>.</p></li>
</ul></div>
<div class="section level3">
<h3 id="code-style">Code style<a class="anchor" aria-label="anchor" href="#code-style"></a></h3>
<ul><li><p>We use <a href="https://cran.r-project.org/package=roxygen2" class="external-link">roxygen2</a>, with <a href="https://cran.r-project.org/web/packages/roxygen2/vignettes/rd-formatting.html" class="external-link">Markdown syntax</a>, for documentation.</p></li>
<li><p>We use <a href="https://cran.r-project.org/package=testthat" class="external-link">testthat</a> for unit tests. Contributions with test cases included are easier to accept.</p></li>
</ul></div>
<div class="section level3">
<h3 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a></h3>
<p>Any interaction with a meteorological API must be done with <code>httr</code> and/or <code>jsonlite</code> and/or <code>xml2</code>, as they are already dependencies of <code>meteospain</code>. See DESCRIPTION file for a list of available dependencies.</p>
</div>
</div>
<div class="section level2">
<h2 id="service-code-guide">Service code guide<a class="anchor" aria-label="anchor" href="#service-code-guide"></a></h2>
<p>When adding a new service to <code>meteospain</code>, there are some conventions to follow:</p>
<div class="section level3">
<h3 id="helpers">Helpers<a class="anchor" aria-label="anchor" href="#helpers"></a></h3>
<p>Each service has an R file associated, <code>[service_name]_helpers.R</code>. In this file we will put all helpers needed to access the service API:</p>
<ul><li><p><code>.create_[service]_path(api_options)</code>: to build the vector with the path, usually depending on the temporal resolution.</p></li>
<li><p><code>.create_[service]_query(api_options)</code>: some APIs need the parameters supplied as queries.</p></li>
<li><p><code>.check_status_[service](api_options)</code>: logic to check the response statuses (200, 429, 500…).</p></li>
<li><p><code>.get_info_[service](api_options)</code>: Access, transform and return the stations info and metadata.</p></li>
<li><p><code>.get_data_[service](api_options)</code>: Access, transform and return the data based on the api options provided (temporal resolution, stations…). This function will use the <code>.create_*</code> and <code>.check_status_[service]</code> helpers.</p></li>
</ul><p>Data must be transformed to sf, adding the stations metadata. Numerical data must be converted to units and variables names standardized among all services.</p>
</div>
<div class="section level3">
<h3 id="options">Options<a class="anchor" aria-label="anchor" href="#options"></a></h3>
<p>Each service must have a dedicated function to create the API options, <code>[service]_options</code>. This function will control which parameters are needed:</p>
<ul><li>
<code>resolution</code>: Temporal resolution for the data (hourly, daily…), used to build paths, queries…</li>
<li>
<code>start_date</code>: Starting date for the desired data, used to build paths, queries…. If the API only accepts one date (see MeteoCat for example), use this one.</li>
<li>
<code>end_date</code>: End date for the desired data, used to build paths, queries…. If the API only accepts one date, this argument is not necessary.</li>
<li>
<code>stations</code>: Character vector with stations IDs to use in paths or queries before retrieving the data or filters after.</li>
</ul><blockquote>
<p>NOTE: When the API only accepts one station when querying by stations, but there is a path to obtain all stations, this one must be used and the desired stations filtered afterwards. This way we reduce the calls to the API, as we dont need to create a loop to return every station in <code>stations</code> argument. If no path exists for getting data from all stations, then a loop should be used.</p>
</blockquote>
<ul><li>
<code>api_key</code>: If the API needs a key, add this argument for the user to supply the key.</li>
</ul><blockquote>
<p>NOTE: <code>meteospain</code> does not store or encrypt in any way the supplied key. Is the user responsability to manage their keys. We recommend the keyring package for this in all docs and functions help.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="tests">Tests<a class="anchor" aria-label="anchor" href="#tests"></a></h3>
<p><code>tests/testthat/test-concordance_between_services.R</code> adds tests for joining data between services.</p>
<p><code>tests/testthat/test-[service].R</code> adds tests for each service.</p>
<p>In <code>utils.R</code> there is a helper function for the main test battery applied to each service: <code>main_test_battery()</code>. See examples of use in the test files of services already implemented.</p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Victor Granda.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

