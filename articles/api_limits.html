<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>API limits and loops • meteospain</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="API limits and loops">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">meteospain</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Services</h6></li>
    <li><a class="dropdown-item" href="../articles/aemet.html">AEMET service</a></li>
    <li><a class="dropdown-item" href="../articles/meteocat.html">MeteoCat service</a></li>
    <li><a class="dropdown-item" href="../articles/meteogalicia.html">MeteoGalicia service</a></li>
    <li><a class="dropdown-item" href="../articles/ria.html">RIA service</a></li>
    <li><a class="dropdown-item" href="../articles/meteoclimatic.html">Meteoclimatic service</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Workflows</h6></li>
    <li><a class="dropdown-item" href="../articles/api_limits.html">API limits and loops</a></li>
    <li><a class="dropdown-item" href="../articles/compatibility.html">Compatibility between services</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emf-creaf/meteospain/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>API limits and loops</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/meteospain/blob/main/vignettes/api_limits.Rmd" class="external-link"><code>vignettes/api_limits.Rmd</code></a></small>
      <div class="d-none name"><code>api_limits.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emf-creaf.github.io/meteospain/">meteospain</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span></code></pre></div>
<p>The following APIs impose a period limit in the data retrieved, not
allowing querying more than the predetermined period in each API.</p>
<div class="section level2">
<h2 id="aemet-api">AEMET API<a class="anchor" aria-label="anchor" href="#aemet-api"></a>
</h2>
<p>AEMET API limit the daily data download to 15 days, and the monthly
and yearly data to 36 months:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># aemet api has a limit for 15 days in daily:</span></span>
<span><span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span></span>
<span>  <span class="st">'aemet'</span>,</span>
<span>  <span class="fu"><a href="../reference/services_options.html">aemet_options</a></span><span class="op">(</span></span>
<span>    api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'aemet'</span><span class="op">)</span>,</span>
<span>    resolution <span class="op">=</span> <span class="st">'daily'</span>,</span>
<span>    start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-01-01'</span><span class="op">)</span>,</span>
<span>    end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-12-31'</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `api_function()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> 404</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> AEMET API returned no data: El rango de fechas no puede ser superior a 15</span></span>
<span><span class="co">#&gt;   dias</span></span>
<span></span>
<span><span class="co"># and monthly and yearly data to 36 months</span></span>
<span><span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span></span>
<span>  <span class="st">'aemet'</span>,</span>
<span>  <span class="fu"><a href="../reference/services_options.html">aemet_options</a></span><span class="op">(</span></span>
<span>    api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'aemet'</span><span class="op">)</span>,</span>
<span>    resolution <span class="op">=</span> <span class="st">'yearly'</span>,</span>
<span>    start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2005-01-01'</span><span class="op">)</span>,</span>
<span>    end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2020-12-31'</span><span class="op">)</span>,</span>
<span>    stations <span class="op">=</span> <span class="st">"0149X"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `api_function()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> 404</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> AEMET API returned no data: El rango de las fechas no puede ser superior a 36</span></span>
<span><span class="co">#&gt;   mesess</span></span></code></pre></div>
<p>This means that with one call to <code>get_meteo_from</code> to the
AEMET service, one can only download 15 days of data, (or 36 months in
monthly and yearly data).<br>
If the period needed is bigger than that, one option is performing all
the calls necessary and join the results:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_1990_jan_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span></span>
<span>  <span class="st">'aemet'</span>,</span>
<span>  <span class="fu"><a href="../reference/services_options.html">aemet_options</a></span><span class="op">(</span></span>
<span>    api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'aemet'</span><span class="op">)</span>,</span>
<span>    resolution <span class="op">=</span> <span class="st">'daily'</span>,</span>
<span>    start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-01-01'</span><span class="op">)</span>,</span>
<span>    end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-01-15'</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00; font-weight: bold;">AEMET como autora de la misma.</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.aemet.es/es/nota_legal</span></span></span>
<span></span>
<span><span class="va">res_1990_jan_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span></span>
<span>  <span class="st">'aemet'</span>,</span>
<span>  <span class="fu"><a href="../reference/services_options.html">aemet_options</a></span><span class="op">(</span></span>
<span>    api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'aemet'</span><span class="op">)</span>,</span>
<span>    resolution <span class="op">=</span> <span class="st">'daily'</span>,</span>
<span>    start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-01-16'</span><span class="op">)</span>,</span>
<span>    end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-01-31'</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00; font-weight: bold;">AEMET como autora de la misma.</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.aemet.es/es/nota_legal</span></span></span>
<span></span>
<span><span class="va">res_1990_jan</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">res_1990_jan_1</span>, <span class="va">res_1990_jan_2</span><span class="op">)</span></span>
<span><span class="va">res_1990_jan</span></span>
<span><span class="co">#&gt; Simple feature collection with 4664 features and 19 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -18.115 ymin: 27.72528 xmax: 4.215556 ymax: 43.65111</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,664 × 20</span></span></span>
<span><span class="co">#&gt;    timestamp           service station_id station_name station_province altitude</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494;">[m]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0002I      <span style="color: #949494;">"</span>VANDELLÒS … TARRAGONA              32</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0016A      <span style="color: #949494;">"</span>REUS AEROP… TARRAGONA              71</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0016B      <span style="color: #949494;">"</span>REUS (CENT… TARRAGONA             118</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0076       <span style="color: #949494;">"</span>BARCELONA … BARCELONA               4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0149D      <span style="color: #949494;">"</span>MANRESA (L… BARCELONA             291</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0158O      <span style="color: #949494;">"</span>MONTSERRAT<span style="color: #949494;">"</span> BARCELONA             738</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0200E      <span style="color: #949494;">"</span>BARCELONA,… BARCELONA             408</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0229I      <span style="color: #949494;">"</span>SABADELL A… BARCELONA             146</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0294B      <span style="color: #949494;">"</span>LA BISBAL … GIRONA                 51</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0321       <span style="color: #949494;">"</span>CAMPDEVANO… GIRONA                731</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,654 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 14 more variables: mean_temperature [°C], min_temperature [°C],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   max_temperature [°C], mean_relative_humidity [%],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   min_relative_humidity [%], max_relative_humidity [%],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   precipitation [L/m^2], wind_direction [°], mean_wind_speed [m/s],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   max_wind_speed [m/s], insolation [h], max_atmospheric_pressure [hPa],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   min_atmospheric_pressure [hPa], geometry &lt;POINT [°]&gt;</span></span></span></code></pre></div>
<p>While for short periods this can be easily done, when needing long
periods (years, decades), this can be tedious and prone to error (or at
least involves a lot of <em>copy&amp;paste</em> and generate longer
scripts).<br>
To avoid this, we can use loops, both in a tidyverse way
(<code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map</a></code>) or in a more classic approach
(<code>for</code>). For both ways, the first thing to do is create the
vectors of dates to retrieve:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, we prepare the date vectors, with the start and end dates.</span></span>
<span><span class="va">start_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-01-01'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-07-01'</span><span class="op">)</span>, <span class="st">'15 days'</span><span class="op">)</span></span>
<span><span class="va">end_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-01-15'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990-07-15'</span><span class="op">)</span>, <span class="st">'15 days'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Both vectors must have the same length</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">start_dates</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">end_dates</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># lets see them</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">start_dates</span>, <span class="va">end_dates</span><span class="op">)</span></span>
<span><span class="co">#&gt;    start_dates  end_dates</span></span>
<span><span class="co">#&gt; 1   1990-01-01 1990-01-15</span></span>
<span><span class="co">#&gt; 2   1990-01-16 1990-01-30</span></span>
<span><span class="co">#&gt; 3   1990-01-31 1990-02-14</span></span>
<span><span class="co">#&gt; 4   1990-02-15 1990-03-01</span></span>
<span><span class="co">#&gt; 5   1990-03-02 1990-03-16</span></span>
<span><span class="co">#&gt; 6   1990-03-17 1990-03-31</span></span>
<span><span class="co">#&gt; 7   1990-04-01 1990-04-15</span></span>
<span><span class="co">#&gt; 8   1990-04-16 1990-04-30</span></span>
<span><span class="co">#&gt; 9   1990-05-01 1990-05-15</span></span>
<span><span class="co">#&gt; 10  1990-05-16 1990-05-30</span></span>
<span><span class="co">#&gt; 11  1990-05-31 1990-06-14</span></span>
<span><span class="co">#&gt; 12  1990-06-15 1990-06-29</span></span>
<span><span class="co">#&gt; 13  1990-06-30 1990-07-14</span></span></code></pre></div>
<div class="section level3">
<h3 id="tidyverse-loop">tidyverse loop<a class="anchor" aria-label="anchor" href="#tidyverse-loop"></a>
</h3>
<p>We are gonna use <code><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">purrr::map2</a></code>, to iterate both date
vectors at the same time and return a data frame with all the results
directly:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tidyverse map</span></span>
<span><span class="va">res_tidyverse</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span></span>
<span>    .x <span class="op">=</span> <span class="va">start_dates</span>, .y <span class="op">=</span> <span class="va">end_dates</span>,</span>
<span>    .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">start_date</span>, <span class="va">end_date</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span></span>
<span>        <span class="st">'aemet'</span>,</span>
<span>        <span class="fu"><a href="../reference/services_options.html">aemet_options</a></span><span class="op">(</span></span>
<span>          api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'aemet'</span><span class="op">)</span>,</span>
<span>          resolution <span class="op">=</span> <span class="st">'daily'</span>,</span>
<span>          start_date <span class="op">=</span> <span class="va">start_date</span>,</span>
<span>          end_date <span class="op">=</span> <span class="va">end_date</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00; font-weight: bold;">AEMET como autora de la misma.</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.aemet.es/es/nota_legal</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00; font-weight: bold;">AEMET como autora de la misma.</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.aemet.es/es/nota_legal</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00; font-weight: bold;">AEMET como autora de la misma.</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.aemet.es/es/nota_legal</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00; font-weight: bold;">AEMET como autora de la misma.</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.aemet.es/es/nota_legal</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00; font-weight: bold;">AEMET como autora de la misma.</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.aemet.es/es/nota_legal</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00; font-weight: bold;">AEMET como autora de la misma.</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.aemet.es/es/nota_legal</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00; font-weight: bold;">AEMET como autora de la misma.</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.aemet.es/es/nota_legal</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00; font-weight: bold;">AEMET como autora de la misma.</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.aemet.es/es/nota_legal</span></span></span>
<span><span class="co">#&gt; Warning: Unable to connect to API at <span style="color: #0000BB; font-style: italic;">&lt;https://opendata.aemet.es&gt;</span>: <span style="color: #0000BB;">Error in</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">curl::curl_fetch_memory(url, handle = handle): Server returned nothing (no</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">headers, no data) [opendata.aemet.es]: Empty reply from server</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> This usually happens when connection with <span style="color: #0000BB; font-style: italic;">&lt;https://opendata.aemet.es&gt;</span> is not</span></span>
<span><span class="co">#&gt;   possible.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">API request truncated</span></span></span>
<span><span class="co">#&gt; Trying again in 60 seconds (retry 1 of 3)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00; font-weight: bold;">AEMET como autora de la misma.</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.aemet.es/es/nota_legal</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00; font-weight: bold;">AEMET como autora de la misma.</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.aemet.es/es/nota_legal</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00; font-weight: bold;">AEMET como autora de la misma.</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.aemet.es/es/nota_legal</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">© AEMET. Autorizado el uso de la información y su reproducción citando a</span></span></span>
<span><span class="co">#&gt;   <span style="color: #BBBB00; font-weight: bold;">AEMET como autora de la misma.</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.aemet.es/es/nota_legal</span></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res_tidyverse</span><span class="op">)</span></span>
<span><span class="co">#&gt;    timestamp service station_id          station_name station_province altitude</span></span>
<span><span class="co">#&gt; 1 1990-01-01   aemet      0002I           VANDELLÒS          TARRAGONA   32 [m]</span></span>
<span><span class="co">#&gt; 2 1990-01-01   aemet      0016A       REUS AEROPUERTO        TARRAGONA   71 [m]</span></span>
<span><span class="co">#&gt; 3 1990-01-01   aemet      0016B REUS (CENTRE LECTURA)        TARRAGONA  118 [m]</span></span>
<span><span class="co">#&gt; 4 1990-01-01   aemet       0076  BARCELONA AEROPUERTO        BARCELONA    4 [m]</span></span>
<span><span class="co">#&gt; 5 1990-01-01   aemet      0149D    MANRESA (LA CULLA)        BARCELONA  291 [m]</span></span>
<span><span class="co">#&gt; 6 1990-01-01   aemet      0158O            MONTSERRAT        BARCELONA  738 [m]</span></span>
<span><span class="co">#&gt;   mean_temperature min_temperature max_temperature mean_relative_humidity</span></span>
<span><span class="co">#&gt; 1        11.2 [°C]        8.8 [°C]       13.7 [°C]                 80 [%]</span></span>
<span><span class="co">#&gt; 2         9.0 [°C]        5.4 [°C]       12.6 [°C]                 89 [%]</span></span>
<span><span class="co">#&gt; 3        10.1 [°C]        8.4 [°C]       11.8 [°C]                 82 [%]</span></span>
<span><span class="co">#&gt; 4         9.2 [°C]        4.0 [°C]       14.4 [°C]                 74 [%]</span></span>
<span><span class="co">#&gt; 5         5.0 [°C]       -1.5 [°C]       11.6 [°C]                 69 [%]</span></span>
<span><span class="co">#&gt; 6         7.0 [°C]        3.0 [°C]       11.0 [°C]                 NA [%]</span></span>
<span><span class="co">#&gt;   min_relative_humidity max_relative_humidity precipitation wind_direction</span></span>
<span><span class="co">#&gt; 1                NA [%]                NA [%]     0 [L/m^2]         30 [°]</span></span>
<span><span class="co">#&gt; 2                NA [%]                NA [%]     0 [L/m^2]         99 [°]</span></span>
<span><span class="co">#&gt; 3                NA [%]                NA [%]     0 [L/m^2]         NA [°]</span></span>
<span><span class="co">#&gt; 4                NA [%]                NA [%]     0 [L/m^2]         NA [°]</span></span>
<span><span class="co">#&gt; 5                NA [%]                NA [%]     0 [L/m^2]         22 [°]</span></span>
<span><span class="co">#&gt; 6                NA [%]                NA [%]     0 [L/m^2]         NA [°]</span></span>
<span><span class="co">#&gt;   mean_wind_speed max_wind_speed insolation max_atmospheric_pressure</span></span>
<span><span class="co">#&gt; 1       1.7 [m/s]      6.4 [m/s]    0.1 [h]                 NA [hPa]</span></span>
<span><span class="co">#&gt; 2       0.6 [m/s]      5.0 [m/s]    0.1 [h]                 NA [hPa]</span></span>
<span><span class="co">#&gt; 3       0.6 [m/s]       NA [m/s]    0.2 [h]                 NA [hPa]</span></span>
<span><span class="co">#&gt; 4       3.6 [m/s]       NA [m/s]    6.7 [h]                 NA [hPa]</span></span>
<span><span class="co">#&gt; 5       0.8 [m/s]      3.9 [m/s]    7.8 [h]                 NA [hPa]</span></span>
<span><span class="co">#&gt; 6        NA [m/s]       NA [m/s]     NA [h]                 NA [hPa]</span></span>
<span><span class="co">#&gt;   min_atmospheric_pressure                   geometry</span></span>
<span><span class="co">#&gt; 1                 NA [hPa] POINT (0.8713889 40.95806)</span></span>
<span><span class="co">#&gt; 2                 NA [hPa]    POINT (1.163611 41.145)</span></span>
<span><span class="co">#&gt; 3                 NA [hPa]  POINT (1.108889 41.15417)</span></span>
<span><span class="co">#&gt; 4                 NA [hPa]      POINT (2.07 41.29278)</span></span>
<span><span class="co">#&gt; 5                 NA [hPa]     POINT (1.840278 41.72)</span></span>
<span><span class="co">#&gt; 6                 NA [hPa]  POINT (1.839167 41.59444)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="for-loop">for loop<a class="anchor" aria-label="anchor" href="#for-loop"></a>
</h3>
<p>We use <code>base::for</code>, iterating by the index of the dates
vectors:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># base for loop</span></span>
<span><span class="va">res_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">index</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">start_dates</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">temp_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span></span>
<span>    <span class="st">'aemet'</span>,</span>
<span>    <span class="fu"><a href="../reference/services_options.html">aemet_options</a></span><span class="op">(</span></span>
<span>      api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'aemet'</span><span class="op">)</span>,</span>
<span>      resolution <span class="op">=</span> <span class="st">'daily'</span>,</span>
<span>      start_date <span class="op">=</span> <span class="va">start_dates</span><span class="op">[</span><span class="va">index</span><span class="op">]</span>,</span>
<span>      end_date <span class="op">=</span> <span class="va">end_dates</span><span class="op">[</span><span class="va">index</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">res_for</span>, <span class="va">temp_res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res_for</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 19 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 0.8713889 ymin: 40.95806 xmax: 2.07 ymax: 41.72</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 20</span></span></span>
<span><span class="co">#&gt;   timestamp           service station_id station_name  station_province altitude</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494;">[m]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0002I      <span style="color: #949494;">"</span>VANDELLÒS  <span style="color: #949494;">"</span> TARRAGONA              32</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0016A      <span style="color: #949494;">"</span>REUS AEROPU… TARRAGONA              71</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0016B      <span style="color: #949494;">"</span>REUS (CENTR… TARRAGONA             118</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0076       <span style="color: #949494;">"</span>BARCELONA A… BARCELONA               4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0149D      <span style="color: #949494;">"</span>MANRESA (LA… BARCELONA             291</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1990-01-01 <span style="color: #949494;">00:00:00</span> aemet   0158O      <span style="color: #949494;">"</span>MONTSERRAT<span style="color: #949494;">"</span>  BARCELONA             738</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 14 more variables: mean_temperature [°C], min_temperature [°C],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   max_temperature [°C], mean_relative_humidity [%],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   min_relative_humidity [%], max_relative_humidity [%],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   precipitation [L/m^2], wind_direction [°], mean_wind_speed [m/s],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   max_wind_speed [m/s], insolation [h], max_atmospheric_pressure [hPa],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   min_atmospheric_pressure [hPa], geometry &lt;POINT [°]&gt;</span></span></span></code></pre></div>
<p>Both methods return identical results:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># both are identical</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">res_tidyverse</span>, <span class="va">res_for</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<blockquote>
<p>In a loop, no matter if a <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map</a></code> or a
<code>for</code> loop, each iteration will connect with the API,
consuming connections from the user quota. Take this into consideration
when creating loops for longer periods, as you can reach your API
request limits for the day/month… (it depends on the service API).</p>
</blockquote>
</div>
</div>
<div class="section level2">
<h2 id="meteocat-api">MeteoCat API<a class="anchor" aria-label="anchor" href="#meteocat-api"></a>
</h2>
<p>When using MeteoCat in <code>daily</code>, <code>monthly</code> and
<code>yearly</code> there are restrictions on the period that can be
accessed.</p>
<div class="section level3">
<h3 id="daily">
<code>daily</code><a class="anchor" aria-label="anchor" href="#daily"></a>
</h3>
<p><code>daily</code> always returns the whole month the date selected
is in, i.e. for <code>start_date = as.Date('2020-04-10')</code> it will
return all days in April, 2020:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">api_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/services_options.html">meteocat_options</a></span><span class="op">(</span></span>
<span>  <span class="st">'daily'</span>, start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2020-04-10'</span><span class="op">)</span>,</span>
<span>  api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'meteocat'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">april_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span><span class="st">'meteocat'</span>, <span class="va">api_options</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">april_2020</span><span class="op">$</span><span class="va">timestamp</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "2020-04-01 UTC" "2020-04-02 UTC" "2020-04-03 UTC" "2020-04-04 UTC"</span></span>
<span><span class="co">#&gt;  [5] "2020-04-05 UTC" "2020-04-06 UTC" "2020-04-07 UTC" "2020-04-08 UTC"</span></span>
<span><span class="co">#&gt;  [9] "2020-04-09 UTC" "2020-04-10 UTC" "2020-04-11 UTC" "2020-04-12 UTC"</span></span>
<span><span class="co">#&gt; [13] "2020-04-13 UTC" "2020-04-14 UTC" "2020-04-15 UTC" "2020-04-16 UTC"</span></span>
<span><span class="co">#&gt; [17] "2020-04-17 UTC" "2020-04-18 UTC" "2020-04-19 UTC" "2020-04-20 UTC"</span></span>
<span><span class="co">#&gt; [21] "2020-04-21 UTC" "2020-04-22 UTC" "2020-04-23 UTC" "2020-04-24 UTC"</span></span>
<span><span class="co">#&gt; [25] "2020-04-25 UTC" "2020-04-26 UTC" "2020-04-27 UTC" "2020-04-28 UTC"</span></span>
<span><span class="co">#&gt; [29] "2020-04-29 UTC" "2020-04-30 UTC"</span></span></code></pre></div>
<p>This means that if we want more than one month, we need to use loops
in a similar way as described previously for AEMET:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2020-01-01'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2020-04-01'</span><span class="op">)</span>, <span class="st">'months'</span><span class="op">)</span></span>
<span><span class="co"># tidyverse map</span></span>
<span><span class="va">meteocat_2020q1_tidyverse</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>    .x <span class="op">=</span> <span class="va">start_dates</span>,</span>
<span>    .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span></span>
<span>        <span class="st">'meteocat'</span>,</span>
<span>        <span class="fu"><a href="../reference/services_options.html">meteocat_options</a></span><span class="op">(</span></span>
<span>          api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'meteocat'</span><span class="op">)</span>,</span>
<span>          resolution <span class="op">=</span> <span class="st">'daily'</span>,</span>
<span>          start_date <span class="op">=</span> <span class="va">start_date</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">meteocat_2020q1_tidyverse</span><span class="op">)</span></span>
<span><span class="co">#&gt;    timestamp  service station_id                station_name station_province</span></span>
<span><span class="co">#&gt; 1 2020-01-01 meteocat         C6         Castellnou de Seana           Lleida</span></span>
<span><span class="co">#&gt; 2 2020-01-01 meteocat         C7                     Tàrrega           Lleida</span></span>
<span><span class="co">#&gt; 3 2020-01-01 meteocat         C8                     Cervera           Lleida</span></span>
<span><span class="co">#&gt; 4 2020-01-01 meteocat         C9            Mas de Barberans        Tarragona</span></span>
<span><span class="co">#&gt; 5 2020-01-01 meteocat         CC                        Orís        Barcelona</span></span>
<span><span class="co">#&gt; 6 2020-01-01 meteocat         CD la Seu d'Urgell - Bellestar           Lleida</span></span>
<span><span class="co">#&gt;   altitude mean_temperature mean_temperature_classic min_temperature</span></span>
<span><span class="co">#&gt; 1  264 [m]         3.9 [°C]                 3.9 [°C]        3.2 [°C]</span></span>
<span><span class="co">#&gt; 2  427 [m]         2.5 [°C]                 2.6 [°C]        1.9 [°C]</span></span>
<span><span class="co">#&gt; 3  554 [m]         1.6 [°C]                 1.5 [°C]        0.6 [°C]</span></span>
<span><span class="co">#&gt; 4  240 [m]         3.4 [°C]                 4.1 [°C]        1.7 [°C]</span></span>
<span><span class="co">#&gt; 5  626 [m]         2.2 [°C]                 4.3 [°C]       -2.5 [°C]</span></span>
<span><span class="co">#&gt; 6  849 [m]         2.5 [°C]                 4.4 [°C]       -3.2 [°C]</span></span>
<span><span class="co">#&gt;   max_temperature thermal_amplitude mean_relative_humidity</span></span>
<span><span class="co">#&gt; 1        4.5 [°C]          1.3 [°C]                 93 [%]</span></span>
<span><span class="co">#&gt; 2        3.3 [°C]          1.4 [°C]                 97 [%]</span></span>
<span><span class="co">#&gt; 3        2.3 [°C]          1.7 [°C]                100 [%]</span></span>
<span><span class="co">#&gt; 4        6.5 [°C]          4.8 [°C]                 87 [%]</span></span>
<span><span class="co">#&gt; 5       11.1 [°C]         13.6 [°C]                 85 [%]</span></span>
<span><span class="co">#&gt; 6       11.9 [°C]         15.1 [°C]                 82 [%]</span></span>
<span><span class="co">#&gt;   min_relative_humidity max_relative_humidity precipitation precipitation_8h_8h</span></span>
<span><span class="co">#&gt; 1                87 [%]                97 [%]   0.0 [L/m^2]         0.0 [L/m^2]</span></span>
<span><span class="co">#&gt; 2                93 [%]               100 [%]   0.0 [L/m^2]         0.3 [L/m^2]</span></span>
<span><span class="co">#&gt; 3               100 [%]               100 [%]   0.1 [L/m^2]         0.3 [L/m^2]</span></span>
<span><span class="co">#&gt; 4                72 [%]                97 [%]   0.0 [L/m^2]         0.0 [L/m^2]</span></span>
<span><span class="co">#&gt; 5                53 [%]                96 [%]   0.0 [L/m^2]         0.0 [L/m^2]</span></span>
<span><span class="co">#&gt; 6                45 [%]                98 [%]   0.0 [L/m^2]         0.0 [L/m^2]</span></span>
<span><span class="co">#&gt;   max_precipitation_minute max_precipitation_hour max_precipitation_30m</span></span>
<span><span class="co">#&gt; 1              0.0 [L/m^2]            0.0 [L/m^2]           0.0 [L/m^2]</span></span>
<span><span class="co">#&gt; 2              0.0 [L/m^2]            0.0 [L/m^2]           0.0 [L/m^2]</span></span>
<span><span class="co">#&gt; 3              0.1 [L/m^2]            0.1 [L/m^2]           0.1 [L/m^2]</span></span>
<span><span class="co">#&gt; 4              0.0 [L/m^2]            0.0 [L/m^2]           0.0 [L/m^2]</span></span>
<span><span class="co">#&gt; 5              0.0 [L/m^2]            0.0 [L/m^2]           0.0 [L/m^2]</span></span>
<span><span class="co">#&gt; 6              0.0 [L/m^2]            0.0 [L/m^2]           0.0 [L/m^2]</span></span>
<span><span class="co">#&gt;   max_precipitation_10m mean_wind_direction max_wind_direction mean_wind_speed</span></span>
<span><span class="co">#&gt; 1            NA [L/m^2]              NA [°]             NA [°]        NA [m/s]</span></span>
<span><span class="co">#&gt; 2            NA [L/m^2]              NA [°]             NA [°]        NA [m/s]</span></span>
<span><span class="co">#&gt; 3            NA [L/m^2]              NA [°]             NA [°]        NA [m/s]</span></span>
<span><span class="co">#&gt; 4            NA [L/m^2]              NA [°]             NA [°]        NA [m/s]</span></span>
<span><span class="co">#&gt; 5            NA [L/m^2]              NA [°]             NA [°]        NA [m/s]</span></span>
<span><span class="co">#&gt; 6            NA [L/m^2]              NA [°]             NA [°]        NA [m/s]</span></span>
<span><span class="co">#&gt;   max_wind_speed global_solar_radiation mean_atmospheric_pressure</span></span>
<span><span class="co">#&gt; 1       NA [m/s]           1.6 [MJ/m^2]              1001.7 [hPa]</span></span>
<span><span class="co">#&gt; 2       NA [m/s]           1.4 [MJ/m^2]               981.6 [hPa]</span></span>
<span><span class="co">#&gt; 3       NA [m/s]           1.6 [MJ/m^2]               965.9 [hPa]</span></span>
<span><span class="co">#&gt; 4       NA [m/s]           4.1 [MJ/m^2]              1003.2 [hPa]</span></span>
<span><span class="co">#&gt; 5       NA [m/s]           8.1 [MJ/m^2]               956.6 [hPa]</span></span>
<span><span class="co">#&gt; 6       NA [m/s]           8.2 [MJ/m^2]               931.5 [hPa]</span></span>
<span><span class="co">#&gt;   max_atmospheric_pressure min_atmospheric_pressure mean_snow_cover</span></span>
<span><span class="co">#&gt; 1             1003.3 [hPa]             1000.7 [hPa]         NA [cm]</span></span>
<span><span class="co">#&gt; 2              983.1 [hPa]              980.7 [hPa]         NA [cm]</span></span>
<span><span class="co">#&gt; 3              967.3 [hPa]              965.0 [hPa]         NA [cm]</span></span>
<span><span class="co">#&gt; 4             1004.9 [hPa]             1002.1 [hPa]         NA [cm]</span></span>
<span><span class="co">#&gt; 5              957.9 [hPa]              955.5 [hPa]         NA [cm]</span></span>
<span><span class="co">#&gt; 6              933.1 [hPa]              929.7 [hPa]         NA [cm]</span></span>
<span><span class="co">#&gt;   max_snow_cover new_snow_cover min_snow_cover reference_evapotranspiration</span></span>
<span><span class="co">#&gt; 1        NA [cm]        NA [cm]        NA [cm]                 0.22 [L/m^2]</span></span>
<span><span class="co">#&gt; 2        NA [cm]        NA [cm]        NA [cm]                 0.18 [L/m^2]</span></span>
<span><span class="co">#&gt; 3        NA [cm]        NA [cm]        NA [cm]                 0.16 [L/m^2]</span></span>
<span><span class="co">#&gt; 4        NA [cm]        NA [cm]        NA [cm]                 0.48 [L/m^2]</span></span>
<span><span class="co">#&gt; 5        NA [cm]        NA [cm]        NA [cm]                 0.75 [L/m^2]</span></span>
<span><span class="co">#&gt; 6        NA [cm]        NA [cm]        NA [cm]                 0.83 [L/m^2]</span></span>
<span><span class="co">#&gt;                   geometry</span></span>
<span><span class="co">#&gt; 1  POINT (0.95172 41.6566)</span></span>
<span><span class="co">#&gt; 2 POINT (1.16234 41.66695)</span></span>
<span><span class="co">#&gt; 3 POINT (1.29609 41.67555)</span></span>
<span><span class="co">#&gt; 4 POINT (0.39988 40.71825)</span></span>
<span><span class="co">#&gt; 5 POINT (2.20862 42.07398)</span></span>
<span><span class="co">#&gt; 6 POINT (1.43277 42.37083)</span></span>
<span></span>
<span><span class="co"># base for loop</span></span>
<span><span class="va">meteocat_2020q1_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">index</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">start_dates</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">temp_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span></span>
<span>    <span class="st">'meteocat'</span>,</span>
<span>    <span class="fu"><a href="../reference/services_options.html">meteocat_options</a></span><span class="op">(</span></span>
<span>      api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'meteocat'</span><span class="op">)</span>,</span>
<span>      resolution <span class="op">=</span> <span class="st">'daily'</span>,</span>
<span>      start_date <span class="op">=</span> <span class="va">start_dates</span><span class="op">[</span><span class="va">index</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">meteocat_2020q1_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">meteocat_2020q1_for</span>, <span class="va">temp_res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">meteocat_2020q1_for</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 33 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 0.39988 ymin: 40.71825 xmax: 2.20862 ymax: 42.37083</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 34</span></span></span>
<span><span class="co">#&gt;   timestamp           service  station_id station_name station_province altitude</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494;">[m]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteocat C6         Castellnou … Lleida                264</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteocat C7         Tàrrega      Lleida                427</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteocat C8         Cervera      Lleida                554</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteocat C9         Mas de Barb… Tarragona             240</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteocat CC         Orís         Barcelona             626</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2020-01-01 <span style="color: #949494;">00:00:00</span> meteocat CD         la Seu d'Ur… Lleida                849</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 28 more variables: mean_temperature [°C], mean_temperature_classic [°C],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   min_temperature [°C], max_temperature [°C], thermal_amplitude [°C],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   mean_relative_humidity [%], min_relative_humidity [%],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   max_relative_humidity [%], precipitation [L/m^2],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   precipitation_8h_8h [L/m^2], max_precipitation_minute [L/m^2],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   max_precipitation_hour [L/m^2], max_precipitation_30m [L/m^2],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   max_precipitation_10m [L/m^2], mean_wind_direction [°], …</span></span></span>
<span></span>
<span><span class="co"># both are identical</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">meteocat_2020q1_tidyverse</span>, <span class="va">meteocat_2020q1_for</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="monthly">
<code>monthly</code><a class="anchor" aria-label="anchor" href="#monthly"></a>
</h3>
<p><code>monthly</code> always returns the whole year the date selected
is in, i.e. for <code>start_date = as.Date('2020-04-10')</code> it will
return all months in 2020:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">api_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/services_options.html">meteocat_options</a></span><span class="op">(</span></span>
<span>  <span class="st">'monthly'</span>, start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2020-04-10'</span><span class="op">)</span>,</span>
<span>  api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'meteocat'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">year_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span><span class="st">'meteocat'</span>, <span class="va">api_options</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">year_2020</span><span class="op">$</span><span class="va">timestamp</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "2020-01-01 UTC" "2020-02-01 UTC" "2020-03-01 UTC" "2020-04-01 UTC"</span></span>
<span><span class="co">#&gt;  [5] "2020-05-01 UTC" "2020-06-01 UTC" "2020-07-01 UTC" "2020-08-01 UTC"</span></span>
<span><span class="co">#&gt;  [9] "2020-09-01 UTC" "2020-10-01 UTC" "2020-11-01 UTC" "2020-12-01 UTC"</span></span></code></pre></div>
<p>Which means that if we need more than one year of monthly data, we
need to use loops again:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2019-01-01'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2020-01-01'</span><span class="op">)</span>, <span class="st">'years'</span><span class="op">)</span></span>
<span><span class="co"># tidyverse map</span></span>
<span><span class="va">meteocat_2019_20_tidyverse</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>    .x <span class="op">=</span> <span class="va">start_dates</span>,</span>
<span>    .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span></span>
<span>        <span class="st">'meteocat'</span>,</span>
<span>        <span class="fu"><a href="../reference/services_options.html">meteocat_options</a></span><span class="op">(</span></span>
<span>          api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'meteocat'</span><span class="op">)</span>,</span>
<span>          resolution <span class="op">=</span> <span class="st">'monthly'</span>,</span>
<span>          start_date <span class="op">=</span> <span class="va">start_date</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">meteocat_2019_20_tidyverse</span><span class="op">)</span></span>
<span><span class="co">#&gt;    timestamp  service station_id                station_name station_province</span></span>
<span><span class="co">#&gt; 1 2019-01-01 meteocat         C6         Castellnou de Seana           Lleida</span></span>
<span><span class="co">#&gt; 2 2019-01-01 meteocat         C7                     Tàrrega           Lleida</span></span>
<span><span class="co">#&gt; 3 2019-01-01 meteocat         C8                     Cervera           Lleida</span></span>
<span><span class="co">#&gt; 4 2019-01-01 meteocat         C9            Mas de Barberans        Tarragona</span></span>
<span><span class="co">#&gt; 5 2019-01-01 meteocat         CC                        Orís        Barcelona</span></span>
<span><span class="co">#&gt; 6 2019-01-01 meteocat         CD la Seu d'Urgell - Bellestar           Lleida</span></span>
<span><span class="co">#&gt;   altitude mean_temperature mean_temperature_classic min_temperature_absolute</span></span>
<span><span class="co">#&gt; 1  264 [m]         2.9 [°C]                 3.3 [°C]                -7.0 [°C]</span></span>
<span><span class="co">#&gt; 2  427 [m]         2.9 [°C]                 3.5 [°C]                -5.0 [°C]</span></span>
<span><span class="co">#&gt; 3  554 [m]         2.5 [°C]                 2.9 [°C]                -5.6 [°C]</span></span>
<span><span class="co">#&gt; 4  240 [m]         9.4 [°C]                 9.6 [°C]                 0.2 [°C]</span></span>
<span><span class="co">#&gt; 5  626 [m]         2.3 [°C]                 3.6 [°C]                -8.3 [°C]</span></span>
<span><span class="co">#&gt; 6  849 [m]         2.9 [°C]                 3.8 [°C]                -7.1 [°C]</span></span>
<span><span class="co">#&gt;   min_temperature_mean max_temperature_absolute max_temperature_mean</span></span>
<span><span class="co">#&gt; 1            -1.8 [°C]                17.9 [°C]             8.5 [°C]</span></span>
<span><span class="co">#&gt; 2            -0.5 [°C]                15.9 [°C]             7.4 [°C]</span></span>
<span><span class="co">#&gt; 3            -0.7 [°C]                14.0 [°C]             6.5 [°C]</span></span>
<span><span class="co">#&gt; 4             5.1 [°C]                18.0 [°C]            14.0 [°C]</span></span>
<span><span class="co">#&gt; 5            -2.7 [°C]                15.7 [°C]             9.9 [°C]</span></span>
<span><span class="co">#&gt; 6            -3.0 [°C]                17.9 [°C]            10.7 [°C]</span></span>
<span><span class="co">#&gt;   max_thermal_amplitude mean_thermal_amplitude extreme_thermal_amplitude</span></span>
<span><span class="co">#&gt; 1             21.7 [°C]              10.3 [°C]                 24.9 [°C]</span></span>
<span><span class="co">#&gt; 2             17.9 [°C]               7.8 [°C]                 20.9 [°C]</span></span>
<span><span class="co">#&gt; 3             16.2 [°C]               7.2 [°C]                 19.6 [°C]</span></span>
<span><span class="co">#&gt; 4             16.0 [°C]               8.9 [°C]                 17.8 [°C]</span></span>
<span><span class="co">#&gt; 5             18.5 [°C]              12.6 [°C]                 24.0 [°C]</span></span>
<span><span class="co">#&gt; 6             20.6 [°C]              13.7 [°C]                 25.0 [°C]</span></span>
<span><span class="co">#&gt;   mean_relative_humidity min_relative_humidity_absolute</span></span>
<span><span class="co">#&gt; 1                 84 [%]                         23 [%]</span></span>
<span><span class="co">#&gt; 2                 85 [%]                         28 [%]</span></span>
<span><span class="co">#&gt; 3                 85 [%]                         27 [%]</span></span>
<span><span class="co">#&gt; 4                 55 [%]                         17 [%]</span></span>
<span><span class="co">#&gt; 5                 73 [%]                          8 [%]</span></span>
<span><span class="co">#&gt; 6                 56 [%]                          4 [%]</span></span>
<span><span class="co">#&gt;   min_relative_humidity_mean max_relative_humidity_absolute</span></span>
<span><span class="co">#&gt; 1                     64 [%]                        100 [%]</span></span>
<span><span class="co">#&gt; 2                     68 [%]                        100 [%]</span></span>
<span><span class="co">#&gt; 3                     70 [%]                        100 [%]</span></span>
<span><span class="co">#&gt; 4                     38 [%]                         97 [%]</span></span>
<span><span class="co">#&gt; 5                     43 [%]                         96 [%]</span></span>
<span><span class="co">#&gt; 6                     28 [%]                         98 [%]</span></span>
<span><span class="co">#&gt;   max_relative_humidity_mean precipitation precipitation_8h_8h</span></span>
<span><span class="co">#&gt; 1                     97 [%]   8.4 [L/m^2]        15.1 [L/m^2]</span></span>
<span><span class="co">#&gt; 2                     96 [%]  14.1 [L/m^2]        19.5 [L/m^2]</span></span>
<span><span class="co">#&gt; 3                     95 [%]  10.4 [L/m^2]        15.1 [L/m^2]</span></span>
<span><span class="co">#&gt; 4                     76 [%]   4.0 [L/m^2]         5.4 [L/m^2]</span></span>
<span><span class="co">#&gt; 5                     90 [%]   8.0 [L/m^2]         9.9 [L/m^2]</span></span>
<span><span class="co">#&gt; 6                     78 [%]  34.9 [L/m^2]        40.5 [L/m^2]</span></span>
<span><span class="co">#&gt;   max_precipitation_minute max_precipitation_24h max_precipitation_24h_8h_8h</span></span>
<span><span class="co">#&gt; 1              0.1 [L/m^2]           3.3 [L/m^2]                 7.3 [L/m^2]</span></span>
<span><span class="co">#&gt; 2              0.1 [L/m^2]           6.1 [L/m^2]                 6.1 [L/m^2]</span></span>
<span><span class="co">#&gt; 3              0.1 [L/m^2]           5.0 [L/m^2]                 5.1 [L/m^2]</span></span>
<span><span class="co">#&gt; 4              0.1 [L/m^2]           1.3 [L/m^2]                 1.4 [L/m^2]</span></span>
<span><span class="co">#&gt; 5              0.2 [L/m^2]           3.6 [L/m^2]                 3.6 [L/m^2]</span></span>
<span><span class="co">#&gt; 6              0.2 [L/m^2]          16.6 [L/m^2]                15.7 [L/m^2]</span></span>
<span><span class="co">#&gt;   max_precipitation_hour max_precipitation_30m max_precipitation_10m</span></span>
<span><span class="co">#&gt; 1            1.0 [L/m^2]           0.8 [L/m^2]            NA [L/m^2]</span></span>
<span><span class="co">#&gt; 2            1.5 [L/m^2]           0.9 [L/m^2]            NA [L/m^2]</span></span>
<span><span class="co">#&gt; 3            1.8 [L/m^2]           1.1 [L/m^2]            NA [L/m^2]</span></span>
<span><span class="co">#&gt; 4            0.6 [L/m^2]           0.6 [L/m^2]            NA [L/m^2]</span></span>
<span><span class="co">#&gt; 5            2.8 [L/m^2]           1.5 [L/m^2]            NA [L/m^2]</span></span>
<span><span class="co">#&gt; 6            3.1 [L/m^2]           1.8 [L/m^2]            NA [L/m^2]</span></span>
<span><span class="co">#&gt;   mean_wind_direction max_wind_direction mean_wind_speed max_wind_speed</span></span>
<span><span class="co">#&gt; 1              NA [°]             NA [°]        NA [m/s]       NA [m/s]</span></span>
<span><span class="co">#&gt; 2              NA [°]             NA [°]        NA [m/s]       NA [m/s]</span></span>
<span><span class="co">#&gt; 3              NA [°]             NA [°]        NA [m/s]       NA [m/s]</span></span>
<span><span class="co">#&gt; 4              NA [°]             NA [°]        NA [m/s]       NA [m/s]</span></span>
<span><span class="co">#&gt; 5              NA [°]             NA [°]        NA [m/s]       NA [m/s]</span></span>
<span><span class="co">#&gt; 6              NA [°]             NA [°]        NA [m/s]       NA [m/s]</span></span>
<span><span class="co">#&gt;   max_wind_speed_mean max_atmospheric_pressure_absolute</span></span>
<span><span class="co">#&gt; 1            NA [m/s]                      1002.1 [hPa]</span></span>
<span><span class="co">#&gt; 2            NA [m/s]                       982.0 [hPa]</span></span>
<span><span class="co">#&gt; 3            NA [m/s]                       966.2 [hPa]</span></span>
<span><span class="co">#&gt; 4            NA [m/s]                      1004.0 [hPa]</span></span>
<span><span class="co">#&gt; 5            NA [m/s]                       957.7 [hPa]</span></span>
<span><span class="co">#&gt; 6            NA [m/s]                       932.2 [hPa]</span></span>
<span><span class="co">#&gt;   min_atmospheric_pressure_absolute global_solar_radiation</span></span>
<span><span class="co">#&gt; 1                       963.8 [hPa]           6.4 [MJ/m^2]</span></span>
<span><span class="co">#&gt; 2                       945.4 [hPa]           6.4 [MJ/m^2]</span></span>
<span><span class="co">#&gt; 3                       930.8 [hPa]           6.7 [MJ/m^2]</span></span>
<span><span class="co">#&gt; 4                       966.9 [hPa]           9.3 [MJ/m^2]</span></span>
<span><span class="co">#&gt; 5                       922.3 [hPa]           8.0 [MJ/m^2]</span></span>
<span><span class="co">#&gt; 6                       897.9 [hPa]           8.4 [MJ/m^2]</span></span>
<span><span class="co">#&gt;   mean_atmospheric_pressure max_atmospheric_pressure_mean</span></span>
<span><span class="co">#&gt; 1               987.2 [hPa]                   990.1 [hPa]</span></span>
<span><span class="co">#&gt; 2               967.8 [hPa]                   970.6 [hPa]</span></span>
<span><span class="co">#&gt; 3               952.3 [hPa]                   955.1 [hPa]</span></span>
<span><span class="co">#&gt; 4               989.1 [hPa]                   991.9 [hPa]</span></span>
<span><span class="co">#&gt; 5               942.9 [hPa]                   945.8 [hPa]</span></span>
<span><span class="co">#&gt; 6               918.4 [hPa]                   921.2 [hPa]</span></span>
<span><span class="co">#&gt;   min_atmospheric_pressure_mean mean_snow_cover max_snow_cover new_snow_cover</span></span>
<span><span class="co">#&gt; 1                   984.4 [hPa]         NA [cm]        NA [cm]        NA [cm]</span></span>
<span><span class="co">#&gt; 2                   965.1 [hPa]         NA [cm]        NA [cm]        NA [cm]</span></span>
<span><span class="co">#&gt; 3                   949.8 [hPa]         NA [cm]        NA [cm]        NA [cm]</span></span>
<span><span class="co">#&gt; 4                   986.4 [hPa]         NA [cm]        NA [cm]        NA [cm]</span></span>
<span><span class="co">#&gt; 5                   940.4 [hPa]         NA [cm]        NA [cm]        NA [cm]</span></span>
<span><span class="co">#&gt; 6                   915.8 [hPa]         NA [cm]        NA [cm]        NA [cm]</span></span>
<span><span class="co">#&gt;                   geometry frost_days rain_days_0 rain_days_02</span></span>
<span><span class="co">#&gt; 1  POINT (0.95172 41.6566)     22 [d]       5 [d]        5 [d]</span></span>
<span><span class="co">#&gt; 2 POINT (1.16234 41.66695)     17 [d]      12 [d]        9 [d]</span></span>
<span><span class="co">#&gt; 3 POINT (1.29609 41.67555)     18 [d]       6 [d]        4 [d]</span></span>
<span><span class="co">#&gt; 4 POINT (0.39988 40.71825)      0 [d]       5 [d]        3 [d]</span></span>
<span><span class="co">#&gt; 5 POINT (2.20862 42.07398)     29 [d]       4 [d]        4 [d]</span></span>
<span><span class="co">#&gt; 6 POINT (1.43277 42.37083)     28 [d]       5 [d]        4 [d]</span></span>
<span></span>
<span><span class="co"># base for loop</span></span>
<span><span class="va">meteocat_2019_20_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">index</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">start_dates</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">temp_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span></span>
<span>    <span class="st">'meteocat'</span>,</span>
<span>    <span class="fu"><a href="../reference/services_options.html">meteocat_options</a></span><span class="op">(</span></span>
<span>      api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'meteocat'</span><span class="op">)</span>,</span>
<span>      resolution <span class="op">=</span> <span class="st">'monthly'</span>,</span>
<span>      start_date <span class="op">=</span> <span class="va">start_dates</span><span class="op">[</span><span class="va">index</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">meteocat_2019_20_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">meteocat_2019_20_for</span>, <span class="va">temp_res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">meteocat_2019_20_for</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 45 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 0.39988 ymin: 40.71825 xmax: 2.20862 ymax: 42.37083</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 46</span></span></span>
<span><span class="co">#&gt;   timestamp           service  station_id station_name station_province altitude</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494;">[m]</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteocat C6         Castellnou … Lleida                264</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteocat C7         Tàrrega      Lleida                427</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteocat C8         Cervera      Lleida                554</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteocat C9         Mas de Barb… Tarragona             240</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteocat CC         Orís         Barcelona             626</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2019-01-01 <span style="color: #949494;">00:00:00</span> meteocat CD         la Seu d'Ur… Lleida                849</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 40 more variables: mean_temperature [°C], mean_temperature_classic [°C],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   min_temperature_absolute [°C], min_temperature_mean [°C],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   max_temperature_absolute [°C], max_temperature_mean [°C],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   max_thermal_amplitude [°C], mean_thermal_amplitude [°C],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   extreme_thermal_amplitude [°C], mean_relative_humidity [%],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   min_relative_humidity_absolute [%], min_relative_humidity_mean [%],</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   max_relative_humidity_absolute [%], max_relative_humidity_mean [%], …</span></span></span>
<span></span>
<span><span class="co"># both are identical</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">meteocat_2019_20_tidyverse</span>, <span class="va">meteocat_2019_20_for</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="yearly">
<code>yearly</code><a class="anchor" aria-label="anchor" href="#yearly"></a>
</h3>
<p><code>yearly</code> always returns all available years and
<code>start_date</code> argument is ignored, i.e. using
<code>start_date = as.Date('2020-04-10')</code> will return all years,
independently of the date supplied:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">api_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/services_options.html">meteocat_options</a></span><span class="op">(</span></span>
<span>  <span class="st">'yearly'</span>, start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2020-04-10'</span><span class="op">)</span>,</span>
<span>  api_key <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">'meteocat'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">all_years</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_meteo_from.html">get_meteo_from</a></span><span class="op">(</span><span class="st">'meteocat'</span>, <span class="va">api_options</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #BBBB00; font-weight: bold;">Data provided by meteo.cat © Servei Meteorològic de Catalunya</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; text-decoration: underline;">https://www.meteo.cat/wpweb/avis-legal/#info</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">all_years</span><span class="op">$</span><span class="va">timestamp</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "1989-01-01 UTC" "1990-01-01 UTC" "1991-01-01 UTC" "1992-01-01 UTC"</span></span>
<span><span class="co">#&gt;  [5] "1993-01-01 UTC" "1994-01-01 UTC" "1995-01-01 UTC" "1996-01-01 UTC"</span></span>
<span><span class="co">#&gt;  [9] "1997-01-01 UTC" "1998-01-01 UTC" "1999-01-01 UTC" "2000-01-01 UTC"</span></span>
<span><span class="co">#&gt; [13] "2001-01-01 UTC" "2002-01-01 UTC" "2003-01-01 UTC" "2004-01-01 UTC"</span></span>
<span><span class="co">#&gt; [17] "2005-01-01 UTC" "2006-01-01 UTC" "2007-01-01 UTC" "2008-01-01 UTC"</span></span>
<span><span class="co">#&gt; [21] "2009-01-01 UTC" "2010-01-01 UTC" "2011-01-01 UTC" "2012-01-01 UTC"</span></span>
<span><span class="co">#&gt; [25] "2013-01-01 UTC" "2014-01-01 UTC" "2015-01-01 UTC" "2016-01-01 UTC"</span></span>
<span><span class="co">#&gt; [29] "2017-01-01 UTC" "2018-01-01 UTC" "2019-01-01 UTC" "2020-01-01 UTC"</span></span>
<span><span class="co">#&gt; [33] "2021-01-01 UTC" "2022-01-01 UTC" "2023-01-01 UTC" "2024-01-01 UTC"</span></span>
<span><span class="co">#&gt; [37] "2025-01-01 UTC"</span></span></code></pre></div>
<p>This means that with yearly we always get all the data available, so
there is no need of loops.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Victor Granda.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
